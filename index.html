<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CraftBio</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <style>
        /* === üé® THEME VARIABLES === */
        :root {
            --card-radius: 24px;
            --font-family: 'Outfit', sans-serif;
            --primary: #0ea5e9;
            --transition: 0.3s ease;
        }

        /* ‚òÄÔ∏è Light Mode (ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä - Soft UI) */
        [data-theme="light"] {
            --bg-gradient: linear-gradient(180deg, #dbeafe 0%, #eff6ff 50%, #f8fafc 100%);
            --text-main: #0f172a;
            --text-muted: #64748b;
            --card-bg: #ffffff;
            --icon-bg: #e0f2fe;
            --border-color: rgba(255,255,255,0.8);
            --shadow-soft: 0 10px 30px -10px rgba(0,0,0,0.08);
            --shadow-hover: 0 20px 40px -10px rgba(14, 165, 233, 0.15);
            --theme-icon: '\f186'; /* ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑŸÇŸÖÿ± */
        }

        /* üåë Dark Mode (ÿØÿßÿ±ŸÉ ŸÖŸàÿØ ŸÜÿßÿπŸÖ) */
        [data-theme="dark"] {
            --bg-gradient: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --card-bg: #1e293b;
            --icon-bg: rgba(14, 165, 233, 0.15);
            --border-color: rgba(255,255,255,0.05);
            --shadow-soft: 0 10px 30px -10px rgba(0,0,0,0.3);
            --shadow-hover: 0 20px 40px -10px rgba(0,0,0,0.5);
            --theme-icon: '\f185'; /* ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿ¥ŸÖÿ≥ */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font-family); transition: background-color 0.3s, color 0.3s, border-color 0.3s, box-shadow 0.3s; }
        
        body { 
            min-height: 100vh; 
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-main); 
            overflow-x: hidden; 
        }

        ::-webkit-scrollbar { display: none; }
        body { -ms-overflow-style: none; scrollbar-width: none; }

        /* === üåô Theme Toggle === */
        .theme-toggle {
            position: absolute; top: 20px; right: 20px;
            width: 44px; height: 44px;
            background: var(--card-bg);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow-soft);
            cursor: pointer;
            z-index: 100;
            color: var(--text-main);
            font-size: 18px;
            border: 1px solid var(--border-color);
        }
        .theme-toggle::before { content: var(--theme-icon); font-family: "Font Awesome 6 Free"; font-weight: 900; }
        .theme-toggle:hover { transform: rotate(15deg) scale(1.1); background: var(--icon-bg); color: var(--primary); }

        /* === Container === */
        .main-container { width: 100%; max-width: 480px; margin: 0 auto; padding: 60px 20px 40px; display: flex; flex-direction: column; gap: 20px; position: relative; }

        /* === Header & Glow === */
        .profile-header { text-align: center; margin-bottom: 10px; }
        
        .avatar-wrapper {
            position: relative; width: 120px; height: 120px; margin: 0 auto 15px; z-index: 1;
        }
        
        /* ‚ú® ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ™ŸàŸáÿ¨ (The Glow) ‚ú® */
        .avatar-wrapper::before {
            content: ''; position: absolute;
            top: -5px; left: -5px; right: -5px; bottom: -5px;
            background: linear-gradient(135deg, var(--primary), #3b82f6);
            border-radius: 50%; z-index: -1;
            filter: blur(15px); opacity: 0.6;
            animation: glowPulse 3s infinite alternate;
        }
        @keyframes glowPulse { 0% { transform: scale(0.95); opacity: 0.5; } 100% { transform: scale(1.1); opacity: 0.8; } }

        .avatar { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 4px solid var(--card-bg); }

        .profile-name { font-size: 28px; font-weight: 800; color: var(--text-main); display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px; }
        .bio-text { font-size: 15px; color: var(--text-muted); font-weight: 500; line-height: 1.5; }
        .bio-sub { font-size: 13px; color: var(--primary); font-weight: 700; margin-top: 5px; text-transform: uppercase; letter-spacing: 0.5px; }

        /* === üñºÔ∏è Wallpaper Widget (Taller & Balanced) === */
        .wall-widget {
            background: var(--card-bg); border-radius: var(--card-radius); padding: 18px;
            display: flex; align-items: center; gap: 18px;
            box-shadow: var(--shadow-soft); transition: var(--transition);
            border: 1px solid var(--border-color);
        }
        .wall-widget:hover { transform: translateY(-3px); box-shadow: var(--shadow-hover); }
        
        /* üí° ÿßŸÑÿ™ÿπÿØŸäŸÑ ŸáŸÜÿß: ÿ™ŸÉÿ®Ÿäÿ± ÿßŸÑÿµŸàÿ±ÿ© ŸÑÿ≤ŸäÿßÿØÿ© ÿ∑ŸàŸÑ ÿßŸÑŸàŸäÿØÿ¨ÿ™ */
        .wall-thumb { 
            width: 95px;  /* ÿπÿ±ÿ∂ ÿ£ŸÉÿ®ÿ± */
            height: 140px; /* ÿ∑ŸàŸÑ ÿ£ŸÉÿ®ÿ± ÿ®ŸÉÿ™Ÿäÿ± */
            border-radius: 18px; 
            object-fit: cover; 
            flex-shrink: 0;
            box-shadow: var(--shadow-soft); /* ÿ∂ŸÑ ŸÑŸÑÿµŸàÿ±ÿ© ŸÜŸÅÿ≥Ÿáÿß */
        }
        
        .wall-content { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .wall-actions { display: flex; align-items: center; gap: 10px; margin-top: 12px; }
        
        .wall-btn {
            background: var(--primary); color: white; padding: 10px 16px; border-radius: 50px;
            font-size: 14px; font-weight: 700; text-decoration: none; flex: 1; text-align: center;
            box-shadow: 0 4px 10px rgba(14, 165, 233, 0.3); transition: 0.2s;
        }
        .wall-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(14, 165, 233, 0.4); }

        .nav-btn {
            width: 36px; height: 36px; border-radius: 50%; border: none;
            background: var(--icon-bg); color: var(--primary); cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-size: 14px;
            transition: 0.2s;
        }
        .nav-btn:hover { background: var(--primary); color: white; transform: scale(1.1); }

        /* === Links === */
        .links-container { display: flex; flex-direction: column; gap: 16px; }
        .grid-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

        .link-card {
            background: var(--card-bg); border-radius: var(--card-radius); padding: 20px;
            display: flex; align-items: center; gap: 15px;
            text-decoration: none; color: var(--text-main);
            box-shadow: var(--shadow-soft); transition: var(--transition);
            border: 1px solid var(--border-color); position: relative;
        }
        .link-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-hover); }

        .half-card { flex-direction: column; text-align: center; justify-content: center; padding: 30px 15px; gap: 12px; }
        
        .icon-box { width: 50px; height: 50px; background: var(--icon-bg); color: var(--primary); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; }
        
        .link-info { flex: 1; overflow: hidden; }
        .link-title { font-weight: 700; font-size: 16px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .link-sub { font-size: 13px; color: var(--text-muted); margin-top: 2px; }

        .badge { position: absolute; top: -10px; right: 20px; background: linear-gradient(135deg, #ff6b6b, #ee5253); color: white; font-size: 11px; font-weight: 700; padding: 4px 12px; border-radius: 20px; box-shadow: 0 4px 10px rgba(238, 82, 83, 0.3); }
        .half-card .badge { right: auto; left: 50%; transform: translateX(-50%); top: -12px; }

        /* === Socials === */
        .social-dock { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; margin-top: 20px; background: var(--card-bg); padding: 12px 20px; border-radius: 100px; width: fit-content; margin-left: auto; margin-right: auto; box-shadow: var(--shadow-soft); border: 1px solid var(--border-color); }
        .social-btn { width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: var(--icon-bg); color: var(--text-muted); font-size: 20px; text-decoration: none; transition: 0.3s; }
        .social-btn:hover { background: var(--primary); color: white; transform: scale(1.1); }

        /* === Landing Page === */
        #home-screen { display: none; height: 100vh; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .home-btn { background: var(--primary); color: white; padding: 15px 40px; border-radius: 50px; text-decoration: none; font-weight: 700; font-size: 18px; box-shadow: var(--shadow-hover); transition: 0.3s; }
        .home-btn:hover { transform: translateY(-3px); box-shadow: 0 15px 30px -5px rgba(14, 165, 233, 0.4); }
        
        .footer { text-align: center; margin-top: 30px; font-size: 13px; color: var(--text-muted); opacity: 0.8; }
        .footer a { color: var(--text-main); text-decoration: none; font-weight: 700; }
    </style>
</head>
<body>

    <div class="theme-toggle" id="themeToggle" onclick="toggleTheme()"></div>

    <div id="profile-screen" class="main-container" style="display:none;">
        
        <div class="profile-header">
            <div class="avatar-wrapper">
                <img src="" id="p_avatar" class="avatar">
            </div>
            <div class="profile-name">
                <span id="p_name">...</span>
                <i class="fa-solid fa-circle-check" style="color:var(--primary); font-size:22px;"></i>
            </div>
            <div class="bio-text" id="p_bio"></div>
            <div class="bio-sub" id="p_sub"></div>
        </div>

        <div id="widget-area" style="display:none;">
            <div class="wall-widget">
                <img src="wallpapers/wallpaper1.png" class="wall-thumb" id="wallImg">
                <div class="wall-content">
                    <h3 style="font-size:17px; font-weight: 800; margin-bottom:4px; color:var(--text-main);">Wall of the Day</h3>
                    <p style="font-size:13px; color:var(--text-muted); font-weight: 500;">Exclusive 4K Wallpaper</p>
                    <div class="wall-actions">
                        <button class="nav-btn" onclick="prevSlide()"><i class="fa-solid fa-chevron-left"></i></button>
                        <a href="#" download id="downloadBtn" class="wall-btn">Download</a>
                        <button class="nav-btn" onclick="nextSlide()"><i class="fa-solid fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <div id="links-area" class="links-container"></div>
        <div id="social-area" class="social-dock"></div>

        <div class="footer">Crafted by <a href="index.html">CraftBio</a></div>
    </div>

    <div id="home-screen">
        <h1 style="font-size:3.5rem; font-weight:900; color:var(--text-main); margin-bottom:10px; letter-spacing: -1.5px;">One Link.<br><span style="color:var(--primary);">All You.</span></h1>
        <p style="color:var(--text-muted); margin-bottom:40px; font-size: 1.2rem; font-weight: 500;">Create your stunning bio link in seconds.</p>
        <a href="signup.html" class="home-btn">Get Started for Free</a>
        <a href="admin.html" style="margin-top:25px; display:block; color:var(--text-muted); font-weight:700; text-decoration:none; font-size: 15px;">Login to Dashboard</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDZnFN7bRbO-S_gw519xTcPR17j1zGyxc4",
            authDomain: "atdesign-portfolio.firebaseapp.com",
            projectId: "atdesign-portfolio",
            storageBucket: "atdesign-portfolio.firebasestorage.app",
            messagingSenderId: "893862249348",
            appId: "1:893862249348:web:50d3e683bba425eb1953d1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Routing
        const urlParams = new URLSearchParams(window.location.search);
        const username = urlParams.get('u');

        if (username) {
            document.getElementById('profile-screen').style.display = 'flex';
            loadData(username);
        } else {
            document.getElementById('home-screen').style.display = 'flex';
            document.getElementById('themeToggle').style.display = 'none';
        }

        async function loadData(user) {
            try {
                let docId = (user === 'atdesign' || user === 'master_data') ? 'master_data' : user;
                let colName = (docId === 'master_data') ? 'settings' : 'users';

                const docRef = doc(db, colName, docId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();

                    document.getElementById('p_avatar').src = data.profile?.avatar || "https://cdn-icons-png.flaticon.com/512/847/847969.png";
                    document.getElementById('p_name').innerText = data.profile?.name || "User";
                    document.getElementById('p_bio').innerText = data.profile?.bioMain || "";
                    document.getElementById('p_sub').innerText = data.profile?.bioSub || "";

                    if (user === 'atdesign' || user === 'master_data') {
                        document.getElementById('widget-area').style.display = 'block';
                    }

                    const linksContainer = document.getElementById('links-area');
                    if (data.links) {
                        let currentRow = null;
                        data.links.forEach((link, idx) => {
                            const isHalf = link.layout === 'half';
                            const badgeHTML = link.badge ? `<span class="badge">${link.badge}</span>` : '';
                            const chevron = !isHalf ? '<i class="fa-solid fa-chevron-right" style="color:var(--text-muted); opacity:0.5;"></i>' : '';
                            const subHTML = (!isHalf && link.subtext) ? `<div class="link-sub">${link.subtext}</div>` : '';

                            const cardHTML = `
                                <a href="${link.url}" target="_blank" class="link-card ${isHalf ? 'half-card' : ''}" onclick="track('${docId}', '${colName}', ${idx})">
                                    ${badgeHTML}
                                    <div class="icon-box"><i class="${link.icon}"></i></div>
                                    <div class="link-info">
                                        <div class="link-title">${link.title}</div>
                                        ${subHTML}
                                    </div>
                                    ${chevron}
                                </a>
                            `;

                            if (isHalf) {
                                if (!currentRow) {
                                    currentRow = document.createElement('div');
                                    currentRow.className = 'grid-row';
                                    linksContainer.appendChild(currentRow);
                                }
                                currentRow.innerHTML += cardHTML;
                                if (currentRow.children.length >= 2) currentRow = null;
                            } else {
                                currentRow = null;
                                const div = document.createElement('div');
                                div.innerHTML = cardHTML;
                                linksContainer.appendChild(div.firstElementChild);
                            }
                        });
                    }

                    const socialArea = document.getElementById('social-area');
                    if (data.socialLinks) {
                        data.socialLinks.forEach(s => {
                            socialArea.innerHTML += `<a href="${s.url}" target="_blank" class="social-btn"><i class="${s.icon}"></i></a>`;
                        });
                    }
                } else {
                    document.getElementById('p_name').innerText = "User not found";
                }
            } catch (e) { console.error(e); }
        }

        window.track = async (id, col, idx) => {
            try {
                const ref = doc(db, col, id);
                const s = await getDoc(ref);
                if (s.exists()) {
                    let links = s.data().links;
                    links[idx].clicks = (links[idx].clicks || 0) + 1;
                    await updateDoc(ref, { links: links });
                }
            } catch(e) {}
        }
    </script>

    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const next = current === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        }
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);

        // üñºÔ∏è Wallpaper Slideshow
        const wallpapers = [
            "wallpapers/wallpaper1.png",
            "wallpapers/wallpaper2.png",
            "wallpapers/wallpaper3.png"
        ];
        let currentWall = 0;
        
        function updateWall() {
            const img = document.getElementById('wallImg');
            const btn = document.getElementById('downloadBtn');
            // Simple fade effect
            img.style.opacity = 0;
            setTimeout(() => {
                img.src = wallpapers[currentWall];
                btn.href = wallpapers[currentWall];
                img.style.opacity = 1;
            }, 200);
        }
        window.nextSlide = function() {
            currentWall = (currentWall + 1) % wallpapers.length;
            updateWall();
        }
        window.prevSlide = function() {
            currentWall = (currentWall - 1 + wallpapers.length) % wallpapers.length;
            updateWall();
        }
        // Initialize first wallpaper link
        document.getElementById('downloadBtn').href = wallpapers[0];
    </script>
</body>
</html>
